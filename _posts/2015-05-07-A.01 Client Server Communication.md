---
layout: post
category : android-User Interface
tags : [Android Tutorial]
---
{% include JB/setup %}

# Introduction
...Client Server communication is an important aspect in android programming. Ideally we retrieve data from server to display it on android screen (web based android application). This tutorial describes how to implement client server communication step by step. 

# How to retrieve Data from Server?
1. Grant internet access in **AndroidManifest.xml** file with the following content
```
<uses-permission android:name="android.permission.INTERNET"></uses-permission>
```
2. **android.os.AsyncTask** class to be used to retrieve data from server. The good idea to check if the network is connected

* Code to check if network is connected. Call the below method before calling the server URL

```
private boolean isNetworkConnected() {
        ConnectivityManager cm = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);
        NetworkInfo ni = cm.getActiveNetworkInfo();
        if (ni == null) {
            // There are no active networks.
            return false;
        } else
            return true;
    }
```

* Code to retrieve data from server

```
public class WebServiceCall extends AsyncTask<Void, Void, String> {

        private DataShareSingleton commonData = DataShareSingleton.getInstance();

        @Override
        protected void onPreExecute() {

            super.onPreExecute();
            if(!isNetworkConnected()) {
                Toast.makeText(getApplicationContext(),"NO INTERNET CONNECTION",Toast.LENGTH_LONG).show();
            }
        }
        @Override
        protected String doInBackground(Void... params) {
            HttpClient httpClient = new DefaultHttpClient();
            HttpContext localContext = new BasicHttpContext();
            String url = "www.google.com"; // This URL will be hit from android client
            HttpGet httpGet = new HttpGet(url);
            String text = null;
            try {
                HttpResponse response = httpClient.execute(httpGet, localContext);
                HttpEntity entity = response.getEntity();
                text = getASCIIContentFromEntity(entity);
            } catch (Exception e) {
                return e.getLocalizedMessage();
            }
            return text;
        }

        @Override
        protected void onPostExecute(String results) {
            if(results == null || results.length() < 100) {
                // Write your logic to process data

            }
        }

        protected String getASCIIContentFromEntity(HttpEntity entity) throws IllegalStateException, IOException {
            InputStream in = entity.getContent();

            StringBuffer out = new StringBuffer();
            int n = 1;
            while (n>0) {
                byte[] b = new byte[4096];
                n =  in.read(b);
                if (n>0) out.append(new String(b, 0, n));
            }
            return out.toString();
        }
    }
```
